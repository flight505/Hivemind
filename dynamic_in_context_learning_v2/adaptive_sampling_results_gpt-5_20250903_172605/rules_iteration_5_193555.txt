PREDICTIVE RULES - ITERATION 5
============================================================

IMPROVED PREDICTIVE RULES:

1. CryoSleep = True and total spend <= 20:
   - Default: Transported = True.
   - Expanded exception (do not auto‑True; first apply Rule 22; if no majority, apply fallback below):
     - If Destination in {TRAPPIST-1e, PSO J318.5-22} AND Cabin deck in {E, G}, OR HomePlanet = Earth AND Cabin deck = G, OR Age <= 12.
   - Fallback when exception applies and no group/cabin majority:
     - If Age <= 12 AND HomePlanet = Earth -> Transported = False.
     - Else if HomePlanet = Earth AND Cabin deck = G AND 13 <= Age <= 60 -> Transported = False.
     - Otherwise keep default True.

2. CryoSleep = True and total spend in (20, 200]:
   - Default: Transported = True.
   - Apply the same exception and fallback as in Rule 1.

3. Children (Age <= 12):
   - If CryoSleep = True -> Transported = True (subject to Rule 1 exception/fallback).
   - If CryoSleep = False and total spend = 0 and Destination = TRAPPIST-1e -> Transported = False unless Rule 22 yields True.
   - If Destination = 55 Cancri e and total spend = 0 -> Transported = True.

4. Tech/spa penalty (global):
   - If (Spa + VRDeck) >= 2000 -> Transported = False.
   - Else if (Spa + VRDeck) in [1200, 1999] OR VRDeck >= 1000 -> Transported = False when retail_share = (FoodCourt+ShoppingMall)/total < 50%.
   - For Destination = TRAPPIST-1e and CryoSleep = False: if VRDeck >= 500 AND retail_share < 60% AND max(FoodCourt, ShoppingMall) < 800 -> Transported = False.

5. Non-Cryo, Destination = TRAPPIST-1e, FoodCourt-dominant retail:
   - If FoodCourt/total >= 55% AND total in [300, 7000] AND (Spa + VRDeck) <= 300 AND nonzero categories <= 3 -> Transported = True.
   - If exactly one nonzero category = FoodCourt (FoodCourt-only): require FoodCourt >= 1000 OR Age >= 21 for the above positive to apply.

6. Non-Cryo, Destination = TRAPPIST-1e, single-category moderate tech:
   - If exactly one of {Spa, VRDeck} > 0, the other = 0/NaN, all other spend = 0/NaN, and (Spa + VRDeck) in [500, 1200] -> Transported = True.

7. Non-Cryo, Destination = TRAPPIST-1e, small‑total mixed VR with some retail (new positive):
   - If VRDeck in [450, 700] AND Spa <= 80 AND retail = (FoodCourt + ShoppingMall) >= 120 AND total in [400, 1200] AND nonzero categories <= 3 -> Transported = True.

8. Refined TRAPPIST-1e low‑total mixed‑tech negative (replacing prior Rule 23):
   - Transported = False when total in [200, 1200] AND retail_share < 40% AND (Spa + VRDeck) > 0.
   - Do not apply if Rule 7 triggers or if FoodCourt >= 150.

9. Non-Cryo, Destination = TRAPPIST-1e, ShoppingMall-only retail:
   - If exactly one nonzero category = ShoppingMall, ShoppingMall in [600, 2000], RoomService = 0, and (Spa + VRDeck) = 0 -> Transported = True (as in prior TRAP single‑category retail positive).

10. Non-Cryo, Destination = 55 Cancri e (expanded retail positives; refined):
    - 10a. FoodCourt-heavy branch: If FoodCourt/total >= 55% AND FoodCourt >= 600 AND (Spa + VRDeck) <= 1000 AND total <= 12000 AND nonzero categories <= 3 -> Transported = True.
    - 10b. Retail-share branch (exclude ShoppingMall-only): If retail_share >= 80% AND (Spa + VRDeck) <= 1000 AND total <= 12000 AND nonzero categories <= 3 AND not(ShoppingMall > 0 AND FoodCourt = 0) -> Transported = True.

11. 55 Cancri e strong-FoodCourt override despite high tech:
    - If FoodCourt >= 3500 AND retail_share >= 45% AND (Spa + VRDeck) <= 3600 AND CryoSleep = False -> Transported = True.

12. Non-Cryo, Destination = 55 Cancri e (refined negatives):
    - If (Spa + VRDeck) >= 1500 -> Transported = False unless Rule 11 triggers.
    - Else if nonzero categories >= 3 AND total >= 3500 AND retail_share < 65% -> Transported = False.

13. Non-Cryo, Destination = PSO J318.5-22:
    - Default: Transported = False.
    - Positive exceptions:
      - 13a. Retail FoodCourt-dominant: FoodCourt/total >= 70% AND (Spa + VRDeck) <= 200 AND total in [150, 3000] AND nonzero categories <= 2 -> Transported = True.
      - 13b. Retail ShoppingMall-dominant: ShoppingMall/total >= 70% AND (Spa + VRDeck) <= 200 AND total in [150, 3000] AND nonzero categories <= 2 -> Transported = True.

14. Destination unknown (NaN), retail-positive fallback:
    - If CryoSleep = False AND (FoodCourt >= 1000 OR ShoppingMall >= 800) AND retail_share >= 80% AND (Spa + VRDeck) <= 800 AND nonzero categories <= 3 AND total <= 12000 -> Transported = True.

15. RoomService-only spend (only RoomService > 0, others = 0/NaN) AND CryoSleep = False:
    - If RoomService <= 200 -> Transported = True.
    - If RoomService > 200 -> Transported = False.

16. RoomService-dominant (CryoSleep = False):
    - If RoomService/total >= 70% AND RoomService >= 500 -> Transported = False.

17. Refined multi-category penalty:
    - Predict Transported = False for nonzero categories >= 3 only when:
      - total >= 4000 AND retail_share < 60%, OR
      - (Spa + VRDeck) >= 600 AND retail_share < 60%.
    - Do not penalize retail-dominant positives (Rules 5, 6, 9, 10, 11, 15 override).

18. VIP = True:
    - If (Spa + VRDeck) >= 800 -> Transported = False.
    - Otherwise, ignore VIP status and apply spend/destination rules.

19. CryoSleep missing:
    - If total spend = 0:
      - First apply Rule 22 (group/cabin majority; allow single-member inference per Rule 22 when eligible).
      - If no majority: If Destination = TRAPPIST-1e AND Age <= 12 -> Transported = False; else treat as CryoSleep = True and apply Rules 1–3.
      - If HomePlanet = Earth AND Cabin deck = G AND 13 <= Age <= 60 -> lean False (unless Rule 22 yields True).
    - If total spend > 0 -> treat as CryoSleep = False and apply destination/spend rules.

20. TRAPPIST-1e, non-Cryo, mid-retail (retail positives):
    - If retail_share >= 60% AND total in [300, 3500] AND (Spa + VRDeck) <= 300 AND nonzero categories <= 3 -> Transported = True (subject to Rule 5 FoodCourt-only tightening).

21. Retail override precedence:
    - When a retail-dominant positive rule (5, 6, 9, 10, 11, 20) triggers, it overrides moderate tech/spa penalties (< 1600) and the multi-category penalty.

22. Group/cabin majority inference (strengthened for minors/zero-spend):
    - For zero/trace-spend cases (total <= 20) or Age <= 12: apply group (PassengerId prefix) or shared-cabin inference when there is at least one other known member; use that member’s label.
    - Otherwise: require at least two other known members AND agreement >= 2/3.
    - Do not apply group/cabin majority when the individual has strong spend/destination evidence (Rules 4–13, 20–21).

23. Spend handling:
    - Treat NaNs in spend fields as 0 for all calculations; compute total = sum(RoomService, FoodCourt, ShoppingMall, Spa, VRDeck) using zero-imputation.

24. Cabin side/deck as tiebreakers only:
    - Use Cabin side ('P' lean True; 'S' lean False) and deck tendencies only when spend patterns, destination, CryoSleep, and age rules do not provide a clear decision.
    - Do not override strong spend/destination signals with side/deck.

============================================================